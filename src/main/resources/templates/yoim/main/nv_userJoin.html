<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      layout:decorate="~{layouts/default}">
<head>
<script th:inline="javascript">




	$(document).ready(function() {

		
		const sessionData = {
		    providerId:   /*[[${session.providerId}]]*/ null,
			providerType: /*[[${session.providerType}]]*/ null,
			providerNick: /*[[${session.providerNickNm}]]*/ null
		};
		
		console.log(providerId);
		const isSso = !!sessionData.providerId;
	    if (isSso) {
	      // 이메일/비번 필드 숨김 + 전송 제외(disabled)
	      $('#emailDiv, #loginPwDiv, #loginPwChkDiv')
	        .hide()
	        .find('input').prop('disabled', true).val('');

	      // 닉네임 비어있으면 카카오 닉네임 채워줌(있으면 유지)
	      if (!$('#nickNm').val() && sessionData.providerNick) {
	        $('#nickNm').val(sessionData.providerNick);
	      }

	      // 폼에 sso 플래그
	      $('#registerForm').attr('data-sso', '1');
	    } else {
	      $('#registerForm').attr('data-sso', '0');
	    }

	    // 처음 진입 시 버튼 상태 한 번 계산
	    if (typeof window.checkJoinForm === 'function') window.checkJoinForm();
	    
	    
	    $('.custom-select-box .select-options').on('click', 'li', function(){
	        const value = $(this).data('value');                       // 예: 1995, 09, 07
	        const $box  = $(this).closest('.custom-select-box');       // year | month | day
	        const type  = $box.data('type');                           // "year"|"month"|"day"
	        const $btn  = $box.find('.select-btn');

	        // 버튼 표시/데이터값 업데이트
	        $btn.find('span').text($(this).text());
	        $btn.attr('data-value', value); // dataset.value 대용

	        // hidden 업데이트
	        if (type === 'year')  $('#birthY').val(value);
	        if (type === 'month') $('#birthM').val(value);
	        if (type === 'day')   $('#birthD').val(value);

	        // (선택) YYYY-MM-DD 조합값
	        const y = $('#birthY').val(), m = $('#birthM').val(), d = $('#birthD').val();
	        if (y && m && d) $('#birthDate').val(`${y}-${m}-${d}`);

	        // 네가 쓰던 폼 활성화 체크 호출
	        if (typeof window.checkJoinForm === 'function') window.checkJoinForm();
	      });
	});
	
	function nextHost(){
		$("#joinDiv1").hide();
		$("#joinDiv2").show();
	}
	
	</script>
</head>
<body>

<!-- wrap -->
<div id="container" layout:fragment="content">
    <main id="contents">
	<form id="registerForm" name="registerForm" action="/main/ts_signup" method="post">
	<input type="hidden" name="providerId" id="providerId" th:value="${session.providerId}" >
	<input type="hidden" name="providerNickNm" id="providerNickNm" th:value="${session.providerNickNm}" >
	<input type="hidden" name="providerType" id="providerType" th:value="${session.providerType}" >
	<!-- 생년월일 전송용 hidden -->
	<input type="hidden" name="birthY" id="birthY">
	<input type="hidden" name="birthM" id="birthM">
	<input type="hidden" name="birthD" id="birthD">
	<input type="hidden" name="birthDate" id="birthDate">
        <div class="contents-wrap">
            <div class="inner-flex">

                <!-- 회원가입(개인정보 처리방침) -->
                <div class="join" id="joinDiv1">

                    <div class="join-tit-wrap">
                        <h2 class="join-tit">
                            처음 뵙겠습니다! <br>
                            약관 동의 후 인증해 주세요.
                        </h2>
                    </div>


                    <div class="join-wrap">
                        <div class="all-check">
                            <div class="check">
                                <label>
                                    <input type="checkbox" name="" id="">
                                    <span class="fake-box"></span>
                                    <span class="txt">약관 전체동의</span>
                                </label>
                            </div>
                        </div>

                        <div class="check-wrap">
                            <div class="check">
                                <label>
                                    <input type="checkbox" name="" id="">
                                    <span class="fake-box"></span>
                                    <span class="txt">(필수) 이용약관</span>
                                </label>
                                <a href="javascript:void(0);" class="arr-right"></a>
                            </div>
                            <div class="check">
                                <label>
                                    <input type="checkbox" name="" id="">
                                    <span class="fake-box"></span>
                                    <span class="txt">(필수) 만 14세 이상 확인 </span>
                                </label>
                                <a href="javascript:void(0);" class="arr-right"></a>
                            </div>
                            <div class="check">
                                <label>
                                    <input type="checkbox" name="" id="">
                                    <span class="fake-box"></span>
                                    <span class="txt">(필수) 개인정보 수집 및 이용 동의</span>
                                </label>
                                <a href="javascript:void(0);" class="arr-right"></a>
                            </div>
                            <div class="check">
                                <label>
                                    <input type="checkbox" name="" id="">
                                    <span class="fake-box"></span>
                                    <span class="txt">(선택) 개인정보 수집 및 이용 동의</span>
                                </label>
                                <a href="javascript:void(0);" class="arr-right"></a>
                            </div>
                            <div class="check">
                                <label>
                                    <input type="checkbox" name="" id="">
                                    <span class="fake-box"></span>
                                    <span class="txt">(선택) 위치기반 서비스 이용약관 동의</span>
                                </label>
                                <a href="javascript:void(0);" class="arr-right"></a>
                            </div>
                        </div>

                        <div class="btn-wrap">
                            <button type="button" class="btn line-blue inactive" onclick="nextHost()">본인 인증하기</button>
                        </div>
                    </div>

                </div>
                <!--// 회원가입(개인정보 처리방침) -->


                <!-- 회원가입(개인정보 입력) -->
                <div class="join" id="joinDiv2" style="display: none;">

                    <div class="join-tit-wrap">
                        <h2 class="join-tit">
                            필수 정보 입력
                        </h2>
                        <span class="join-txt">가입을 위해 필수 정보를 입력해 주세요.</span>
                    </div>


                    <div class="join-wrap join-info">
                        <div class="form-area">

                            <div class="form col" id="emailDiv">
                                <div class="form-tit-wrap">
                                    <span class="form-tit required">이메일</span>
                                </div>
                                <div class="form-cont-wrap">
                                    <input type="text" id="email" name="email" placeholder="yomi@example.com">

                                    <!--- 입력 안했을때 error 클래스 주면 됨. -->
                                    <!--<input type="text" placeholder="yomi@example.com" class="error">-->
                                    <span class="txt-error" id="email_text_error" style="display: none;">이메일을 입력해주세요.</span>
                                </div>
                            </div>

                            <div class="form col" id="loginPwDiv">
                                <div class="form-tit-wrap">
                                    <span class="form-tit required">비밀번호</span>
                                </div>
                                <div class="form-cont-wrap">
                                    <div class="password"> <!-- 비밀번호 입력안했을때, 오류일때 error 클래스(password 에 넣어주세요.) -->
                                        <input type="password" name="loginPw" id="loginPw" placeholder="비밀번호를 입력하세요.">
                                        <button type="button" class="btn-pw-show"></button>
                                    </div>
                                    <span class="txt-success" style="display: none;">사용가능 : 안전한 비밀번호 입니다.</span>
                                    <span class="txt-error" style="display: none;">사용불가 : 최소 8자 이상 입력</span>
                                </div>
                            </div>

                            <div class="form col" id="loginPwChkDiv">
                                <div class="form-tit-wrap">
                                    <span class="form-tit required">비밀번호 확인</span>
                                </div>
                                <div class="form-cont-wrap">
                                    <div class="password">
                                        <input type="password" name="loginPwChk" id="loginPwChk" placeholder="위 비밀번호와 동일하게 입력">
                                        <button type="button" class="btn-pw-show"></button>
                                    </div>

                                    <span class="txt-error" style="display: none;">비밀번호가 일치하지 않습니다.</span>
                                </div>
                            </div>

                            <div class="form col">
                                <div class="form-tit-wrap">
                                    <span class="form-tit required">생년월일</span>
                                </div>
                                <div class="form-cont-wrap">
                                    <div class="birth"> <!-- 생년월일 입력 안했을 시, error 클래스 부여 -->

                                        <div class="custom-select-box" data-type="year">
                                            <button type="button" class="select-btn">
                                                <span>년도</span>
                                            </button>
                                            <ul class="select-options" id="yearUl">

                                            </ul>
                                        </div>

                                        <div class="custom-select-box" data-type="month">
                                            <button type="button" class="select-btn">
                                                <span>월</span>
                                            </button>
                                            <ul class="select-options" id="monthUl">

                                            </ul>
                                        </div>

                                        <div class="custom-select-box" data-type="day">
                                            <button type="button" class="select-btn">
                                                <span>일</span>
                                            </button>
                                            <ul class="select-options" id="dayUl">

                                            </ul>
                                        </div>
                                    </div>

                                    <span class="txt-error" style="display: none;">생년월일을 입력해주세요.</span>
                                </div>

                            </div>

                            <div class="form col">
                                <div class="form-tit-wrap">
                                    <span class="form-tit required">성별</span>
                                </div>
                                <div class="form-cont-wrap">
                                    <div class="radio-group">

                                        <label class="radio">
                                            <input type="radio" name="gender" value="M" checked>
                                            <span class="fake-radio"></span>
                                            <span class="txt">남자</span>
                                        </label>
                                        <label class="radio">
                                            <input type="radio" name="gender" value="W" >
                                            <span class="fake-radio"></span>
                                            <span class="txt">여자</span>
                                        </label>
                                    </div>

                                    <span class="txt-error" style="display: none;">성별을 선택해주세요.</span>
                                </div>
                            </div>
                            
                            <div class="form col">
                                <div class="form-tit-wrap">
                                    <span class="form-tit required">회원 유형</span>
                                </div>
                                <div class="form-cont-wrap">
                                    <div class="radio-group">
                                        <label class="radio">
                                            <input type="radio" name="userType" value="ROLE_USER" checked>
                                            <span class="fake-radio"></span>
                                            <span class="txt">사용자</span>
                                        </label>

                                        <label class="radio">
                                            <input type="radio" name="userType" value="ROLE_HOST">
                                            <span class="fake-radio"></span>
                                            <span class="txt">호스트</span>
                                        </label>
                                    </div>

                                    <span class="txt-error" style="display: none;">성별을 선택해주세요.</span>
                                </div>
                            </div>

                            <div class="form col">
                                <div class="form-tit-wrap">
                                    <span class="form-tit required">닉네임</span>
                                </div>
                                <div class="form-cont-wrap">
                                    <!-- 닉네임 입력 안했을 시 error 클래스 부여 -->
                                    <input type="text" placeholder="닉네임을 입력하세요" id="nickNm" name="nickNm" >

                                    <span class="txt-error" style="display: none;">닉네임을 입력해주세요.</span>
                                </div>
                            </div>
                        </div>

                        <div class="btn-wrap mt50-xl">
                            <button type="submit" class="btn line-blue inactive">입력 완료</button>
                        </div>
                    </div>

                </div>
                <!--// 회원가입(개인정보 입력) -->


            </div>
        </div>

	</form>

    </main>


   


</div>
<!-- //wrap -->
</body>
</html>
